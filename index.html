<!DOCTYPE html>
<html>
  <head>
    <title>vintage</title>
    <style>
      body {
        background-color: rgb(37, 37, 47);
        color: #dbd8b2;
        font-size: 14px;
        font-family: monospace;
      }

      a {
        color: #dbd8b2;
        text-decoration: none;

        &:hover {
          text-decoration: underline;
        }

        &:visited {
          color: #918f7bcf;
        }
      }

      th {
        text-align: left;
        font-size: 16px;
      }

      tr {
        &:hover {
          td {
            background-color: #dbd8b2;
            color: rgb(37, 37, 47);

            a {
              color: rgb(37, 37, 47);
            }
          }
        }
      }

      .btn-grp {
        padding-top: 8px;
        margin-bottom: 24px;
        font-weight: bold;
        font-size: 16px;

        button {
          font-family: monospace;
          border-radius: 0;
          font-weight: bold;
          padding: 4px 10px;

          &:first-of-type {
            border-top-left-radius: 5px;
            border-bottom-left-radius: 5px;
          }

          &:last-of-type {
            border-top-right-radius: 5px;
            border-bottom-right-radius: 5px;
          }

          &.disabled {
            color: gray;
            cursor: pointer;
          }
        }
      }
    </style>
  </head>
  <body>
    <div class="btn-grp">
      Cost:
      <button class="all">All</button><button class="free disabled">Free</button
      ><button class="paid disabled">Paid</button>
    </div>

    <table>
      <thead>
        <tr>
          <th width="50%">App</th>
          <th width="30%">Rating (# of Reviews)</th>
          <th width="20%">Price</th>
        </tr>
      </thead>
      <tbody id="apps"></tbody>
    </table>
    <script>
      let apps;
      let costFilter = "all";

      const appsTableBody = document.getElementById("apps");
      const costFilterAllBtn = document.getElementsByClassName("all")[0];
      const costFilterFreeBtn = document.getElementsByClassName("free")[0];
      const costFilterPaidBtn = document.getElementsByClassName("paid")[0];

      const filterByCost = (apps) => {
        switch (costFilter) {
          case "free":
            return apps.filter((app) => app.price === "free");
            break;
          case "paid":
            return apps.filter((app) => app.price !== "free");
            break;
          case "all":
            return apps;
        }
      };

      costFilterFreeBtn.addEventListener("click", () => {
        if (costFilter === "free") {
          return;
        }
        costFilter = "free";
        costFilterFreeBtn.classList.remove("disabled");
        costFilterAllBtn.classList.add("disabled");
        costFilterPaidBtn.classList.add("disabled");
        buildList(filterByCost(apps));
      });

      costFilterAllBtn.addEventListener("click", () => {
        if (costFilter === "all") {
          return;
        }
        costFilter = "all";
        costFilterAllBtn.classList.remove("disabled");
        costFilterFreeBtn.classList.add("disabled");
        costFilterPaidBtn.classList.add("disabled");
        buildList(filterByCost(apps));
      });

      costFilterPaidBtn.addEventListener("click", () => {
        if (costFilter === "paid") {
          return;
        }
        costFilter = "paid";
        costFilterPaidBtn.classList.remove("disabled");
        costFilterFreeBtn.classList.add("disabled");
        costFilterAllBtn.classList.add("disabled");
        buildList(filterByCost(apps));
      });

      const buildList = (appsToRender) => {
        const rows = appsToRender
          .map((app) => {
            return `

                <tr>
                  <td class="app-name"><a href="${app.url}" target="_blank" alt="${app.name}">${app.name}</a></td>
                  <td>${app.rating} (${app.numberOfRatings})</td>
                  <td>${app.price}</td>
                </tr>

            `;
          })
          .join("");
        appsTableBody.innerHTML = rows;
      };

      document.addEventListener("DOMContentLoaded", () => {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "data.json", true);
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4 && xhr.status == 200) {
            var data = JSON.parse(xhr.responseText);
            apps = data;
            buildList(filterByCost(apps));
          }
        };
        xhr.send();
      });
    </script>
  </body>
</html>

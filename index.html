<!DOCTYPE html>
<html>
  <head>
    <title>vintage</title>
    <style>
      body {
        background-color: rgb(37, 37, 47);
        color: #dbd8b2;
        font-size: 14px;
        font-family: monospace;
      }

      a {
        color: #dbd8b2;
        text-decoration: none;

        &:hover {
          text-decoration: underline;
        }

        &:visited {
          color: #918f7bcf;
        }
      }

      th {
        text-align: left;
        font-size: 16px;
      }

      tr {
        &:hover {
          td {
            background-color: #dbd8b2;
            color: rgb(37, 37, 47);

            a {
              color: rgb(37, 37, 47);
            }
          }
        }
      }

      .btn-grp {
        padding-top: 8px;
        margin-bottom: 24px;
        font-weight: bold;
        font-size: 16px;

        button {
          font-family: monospace;
          border-radius: 0;
          font-weight: bold;
          padding: 4px 10px;

          &:first-of-type {
            border-top-left-radius: 5px;
            border-bottom-left-radius: 5px;
          }

          &:last-of-type {
            border-top-right-radius: 5px;
            border-bottom-right-radius: 5px;
          }

          &.disabled {
            color: gray;
            cursor: pointer;
          }
        }
      }
    </style>
  </head>
  <body>
    <div class="btn-grp cost-btns">
      Cost:
      <button>Free</button><button>Paid</button>
    </div>
    <div class="btn-grp genre-btns">
      Genre:
      <button>Action</button><button>Adventure</button><button>Board</button
      ><button>Card</button><button>Casino</button><button>Casual</button
      ><button>Family</button><button>Music</button><button>Puzzle</button
      ><button>Racing</button><button>Role Playing</button
      ><button>Simulation</button><button>Sports</button
      ><button>Strategy</button><button>Trivia</button><button>Word</button>
    </div>

    <table>
      <thead>
        <tr>
          <th width="50%">App</th>
          <th width="15%">Genre</th>
          <th width="20%">Rating (# of Reviews)</th>
          <th width="15%">Price</th>
        </tr>
      </thead>
      <tbody id="apps"></tbody>
    </table>
    <script>
      let apps;
      let costFilter = ["paid", "free"];
      let genreFilter = [
        "action",
        "adventure",
        "board",
        "card",
        "casino",
        "casual",
        "family",
        "music",
        "puzzle",
        "racing",
        "role-playing",
        "simulation",
        "sports",
        "strategy",
        "trivia",
        "word",
      ];

      const appsTableBody = document.getElementById("apps");
      const costBtns = document
        .getElementsByClassName("cost-btns")[0]
        .getElementsByTagName("button");
      const genreBtns = document
        .getElementsByClassName("genre-btns")[0]
        .getElementsByTagName("button");

      const filterApps = () => {
        let filteredApps = apps;

        if (costFilter.includes("free") && !costFilter.includes("paid")) {
          filteredApps = filteredApps.filter((app) => app.price === "free");
        } else if (
          costFilter.includes("paid") &&
          !costFilter.includes("free")
        ) {
          filteredApps = filteredApps.filter((app) => app.price !== "free");
        }

        filteredApps = filteredApps.filter((app) =>
          app.genres.some((genre) => genreFilter.includes(genre))
        );

        return filteredApps;
      };

      for (let i = 0; i < genreBtns.length; i++) {
        genreBtns[i].addEventListener("click", (el) => {
          const genre = el.target.innerText.toLowerCase().replace(" ", "-");
          const genreIndex = genreFilter.indexOf(genre);
          if (genreIndex >= 0) {
            genreFilter.splice(genreIndex, 1);
            el.target.classList.add("disabled");
          } else {
            genreFilter.push(genre);
            el.target.classList.remove("disabled");
          }
          buildList();
        });
      }

      for (let i = 0; i < costBtns.length; i++) {
        costBtns[i].addEventListener("click", (el) => {
          const cost = el.target.innerText.toLowerCase();
          const costIndex = costFilter.indexOf(cost);
          if (costIndex >= 0) {
            costFilter.splice(costIndex, 1);
            el.target.classList.add("disabled");
          } else {
            costFilter.push(cost);
            el.target.classList.remove("disabled");
          }
          buildList();
        });
      }

      const buildList = () => {
        const appsToRender = filterApps();
        const rows = appsToRender
          .map((app) => {
            return `

                <tr>
                  <td class="app-name"><a href="${app.url}" target="_blank" alt="${app.name}">${app.name}</a></td>
                  <td>${app.genres}</td>
                  <td>${app.rating} (${app.numberOfRatings})</td>
                  <td>${app.price}</td>
                </tr>

            `;
          })
          .join("");
        appsTableBody.innerHTML = rows;
      };

      document.addEventListener("DOMContentLoaded", () => {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "data.json", true);
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4 && xhr.status == 200) {
            var data = JSON.parse(xhr.responseText);
            apps = data;
            buildList();
          }
        };
        xhr.send();
      });
    </script>
  </body>
</html>
